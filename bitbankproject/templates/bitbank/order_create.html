{% extends "bitbank/base.html" %}
{% block content %}
<form action="" method="POST">
        
    {% csrf_token %}

     
        <div class="row align-items-center">
            {{ form.non_field_errors }}
            <div class="col-6">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="my_placeholder">通貨</span>
                    </div>
                    {{form.pair}}
                    {{ form.pair.errors }}
                </div>
                <hr>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="my_placeholder">特殊注文</span>
                    </div>
                    {{form.special_order}}
                    {{ form.special_order.errors }}
                </div>
                
            </div>
            <div class="col-6">
                <table id="asset_table" class="table table-striped table-responsive">
                    <thead>
                        <tr>
                            <th>通貨</th>
                            <th>On hand</th>
                            <th>Locked</th>
                            <th>Free</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
        <hr>
        <div class="row align-items-center">
            <div class="col-6">
                <div class="btn-group d-flex" role="group">
                    <button id="sell_button" type="button" class="btn w-100 btn-base">買い</button>
                    <button id="buy_button" type="button" class="btn w-100 btn-base">売り</button>
                </div>
                <div class="input-group" style="display: none">
                    {{form.side}}
                    {{ form.side.errors }}
                </div>
                <hr>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="my_placeholder">注文方法</span>
                    </div>
                    {{form.order_type}}
                    {{ form.order_type.errors }}
                </div>
                <hr>
                <div style="display: none" class="input-group show_if_limit">
                    <div class="input-group-prepend">
                        <span class="my_placeholder">注文価格</span>
                    </div>
                    {{form.price}}
                    {{form.price.errors}}                    
                    <div class="input-group-append">
                        <span class="my_placeholder">円</span>
                    </div>
                </div>
                <hr>            
                <div style="display:none" class="input-group show_if_reverse_limit">
                    <div class="input-group-prepend">
                        <span class="my_placeholder">逆指値の指値価格</span>
                    </div>
                    {{form.limit_price}}
                    {{form.limit_price.errors}}
                    <div class="input-group-append">
                        <span class="my_placeholder">円</span>
                    </div>
                </div>
                <hr>

                <input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="0"/>
                
                <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="my_placeholder">予想</span>
                        </div>
                        <input type="number" id="expect_amount" class="form-control">
                        <div class="input-group-append">
                            <span class="my_placeholder">円</span>
                        </div>
                    </div>
                <hr>
                    
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="my_placeholder">注文数量</span>
                    </div>
                    {{form.start_amount}}
                    {{form.start_amount.errors}}
                    <div class="input-group-append">
                        <span class="my_placeholder"></span>
                    </div>
                </div>
                <hr>
                <div class="input-group">
                    <button id="id_order_button" type="submit" class="btn btn-lg btn-block green_button">注文</button>
                </div>
                            
            </div>
            <div class="col-6">
                約定通知
                <div class="btn-group d-flex" role="group">
                    <button id="notify_if_filled_on_button" type="button" class="btn w-100 btn-base">ON</button>
                    <button id="notify_if_filled_off_button" type="button" class="btn w-100 btn-base">OFF</button>
                </div>

                <div style="display: none" class="input-group">
                    {{form.notify_if_filled}}
                    {{form.notify_if_filled.errors}}
                    
                </div>
                <hr>
                金額到達通知
                <div class="btn-group d-flex" role="group">
                    <button id="notify_if_reach_on_button" type="button" class="btn w-100 btn-base">ON</button>
                    <button id="notify_if_reach_off_button" type="button" class="btn w-100 btn-base">OFF</button>
                </div>

                <div style="display: none" class="input-group">
                    {{form.notify_if_reach}}
                    {{form.notify_if_reach.errors}}
                </div>
                <hr>
                <div class="input-group">
                    <div class="input-group-prepend">
                       <span class="my_placeholder">①価格到達通知設定</span> 
                    </div>
                    {{form.price_threshold_1}}
                    {{form.price_threshold_1.errors}}
                    
                    <div class="input-group-append">
                        <span class="my_placeholder">円</span>
                    </div>
                </div>
                <hr>            
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="my_placeholder">②価格到達通知設定</span>
                    </div>
                    {{form.price_threshold_2}}
                    {{form.price_threshold_2.errors}}
                    <div class="input-group-append">
                        <span class="my_placeholder">円</span>
                    </div>
                </div>
                <hr>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="my_placeholder">③価格到達通知設定</span>
                    </div>
                    {{form.price_threshold_3}}
                    {{form.price_threshold_3.errors}}
                    <div class="input-group-append">
                        <span class="my_placeholder">円</span>
                    </div>
                </div>
                <hr>            
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="my_placeholder">④価格到達通知設定</span>
                    </div>
                    {{form.price_threshold_4}}
                    {{form.price_threshold_4.errors}}
                    <div class="input-group-append">
                        <span class="my_placeholder">円</span>
                    </div>
                </div>
                <hr>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="my_placeholder">⑤価格到達通知設定</span>
                    </div>
                    {{form.price_threshold_5}}
                    {{form.price_threshold_5.errors}}
                    <div class="input-group-append">
                        <span class="my_placeholder">円</span>
                    </div>
                </div>
            </div>
                
        </div>        
    
</form>
{% endblock %}
{% block extra_js %}
    <script>
    

        $(function() {
            // With JQuery
            $('#ex1').slider({
                formatter: function(value) {
                    currency = $('#id_pair').val().split('_')[1];
                    free_amount = $('#free_' + currency).val();
                    alert(currency);
                    alert('slider');
                }
            });

            //逆指値の時のみ
            $('#id_order_type').on('change', function() {
                if ($(this).val() == '逆指値') {
                    $('.show_if_reverse_limit').show();
                } else {
                    $('.show_if_reverse_limit').hide();
                }
                if ($(this).val() == '指値') {
                    $('.show_if_limit').show();
                } else {
                    $('.show_if_limit').hide();
                }
                
            });
            

            // 売り買いボタン初期化
            if ($('#id_side').val() == 'SELL') {
                $('#sell_button').addClass('chosen').removeClass('btn-base');
                $('#buy_button').removeClass('chosen').addClass('btn-base');
            } else {
                $('#buy_button').addClass('chosen').removeClass('btn-base');
                $('#sell_button').removeClass('chosen').addClass('btn-base');
            }

            // 通知ボタン初期化
            if ($('#id_notify_if_filled').val() == 'ON') {
                $('#notify_if_filled_on_button').addClass('chosen').removeClass('btn-base');
                $('#notify_if_filled_off_button').removeClass('chosen').addClass('btn-base');
            } else {
                $('#notify_if_filled_off_button').addClass('chosen').removeClass('btn-base');
                $('#notify_if_filled_on_button').removeClass('chosen').addClass('btn-base');
            }
            // 金額到達ボタン初期化
            if ($('#id_notify_if_reach').val() == 'ON') {
                $('#notify_if_reach_on_button').addClass('chosen').removeClass('btn-base');
                $('#notify_if_reach_off_button').removeClass('chosen').addClass('btn-base');
            } else {
                $('#notify_if_reach_off_button').addClass('chosen').removeClass('btn-base');
                $('#notify_if_reach_on_button').removeClass('chosen').addClass('btn-base');
            }
            
            //SELLボタンクリック
            $('#sell_button').on('click', function() {
                $('#sell_button').addClass('chosen').removeClass('btn-base');
                $('#buy_button').removeClass('chosen').addClass('btn-base');
                $('#id_side').val('SELL');
            });
            
            //BUYボタンクリック
            $('#buy_button').on('click', function() {
                $('#buy_button').addClass('chosen').removeClass('btn-base');
                $('#sell_button').removeClass('chosen').addClass('btn-base');
                $('#id_side').val('BUY');
            });

            //通知ONボタンクリック
            $('#notify_if_filled_on_button').on('click', function() {
                $('#notify_if_filled_on_button').addClass('chosen').removeClass('btn-base');
                $('#notify_if_filled_off_button').removeClass('chosen').addClass('btn-base');
                $('#id_notify_if_filled').val('ON');
            });
            //通知OFFボタンクリック
            $('#notify_if_filled_off_button').on('click', function() {
                $('#notify_if_filled_off_button').addClass('chosen').removeClass('btn-base');
                $('#notify_if_filled_on_button').removeClass('chosen').addClass('btn-base');
                $('#id_notify_if_filled').val('OFF');
            });

            //金額到達ONボタンクリック
            $('#notify_if_reach_on_button').on('click', function() {
                $('#notify_if_reach_on_button').addClass('chosen').removeClass('btn-base');
                $('#notify_if_reach_off_button').removeClass('chosen').addClass('btn-base');
                $('#id_notify_if_reach').val('ON');
            });
            //金額到達OFFボタンクリック
            $('#notify_id_reach_off_button').on('click', function() {
                $('#notify_if_reach_off_button').addClass('chosen').removeClass('btn-base');
                $('#notify_if_reach_on_button').removeClass('chosen').addClass('btn-base');
                $('#id_notify_if_reach').val('OFF');
            });


            $.ajax({
                'url': '{% url "bitbank:ajax_get_assets" %}',
                'type': 'GET',
                'dataType': 'json'
            }).done( response => {
                if (response.assets) {
                    var asset_html = "";
                    response.assets.forEach(asset => {
                        asset_html += '<tr>';
                        asset_html += '<td>' + asset.asset + '</td>';
                        asset_html += '<td>' + asset.onhand_amount + '</td>';
                        asset_html += '<td>' + asset.locked_amount + '</td>';
                        asset_html += '<td id="free_' + asset.asset + '">' + asset.free_amount + '</td>';
                        asset_html += '</tr>';
                    });
                    $("#asset_table > tbody").html(asset_html);
                } else {
                    if (response.error) {
                        alert(response.error);
                    } else {
                        alert('想定外のエラーです');
                    }
                }
            });
        });
    </script>
{% endblock %}